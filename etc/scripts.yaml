---
- name: "check_disk_usage"
  description: "检查磁盘使用情况，支持指定路径和阈值告警"
  prompt: "检查指定路径的磁盘使用情况，如果使用率超过阈值则告警"
  template: "df -h {path} | awk 'NR>1 && $5+0 > {threshold} {print $6 \": \" $5 \" 使用率过高 (\" $5 \")\"}'"
  parameters:
    - name: "path"
      type: "string"
      required: true
      default: "/"
      description: "要检查的路径"
      validation: "^[a-zA-Z0-9/_-]+$"
    - name: "threshold"
      type: "integer"
      required: false
      default: 80
      description: "使用率阈值百分比 (0-100)"
      validation: "^[0-9]+$"
  allowed_hosts: ["*"]
  timeout_sec: 30
  use_shell: true
  working_dir: "/"
  tag: "default"

- name: "find_large_files"
  description: "在指定目录下查找大于指定大小的文件"
  prompt: "在指定目录下查找大于指定大小的文件，并显示文件详细信息"
  template: "find {directory} -type f -size +{size_min} -exec ls -lh {{}} \\;"
  parameters:
    - name: "directory"
      type: "string"
      required: true
      default: "/var/log"
      description: "搜索目录"
      validation: "^[a-zA-Z0-9/_-]+$"
    - name: "size_min"
      type: "string"
      required: false
      default: "100M"
      description: "最小文件大小 (支持 K/M/G)"
      validation: "^[0-9]+[KMG]?$"
  allowed_hosts: ["*"]
  timeout_sec: 60
  use_shell: true
  working_dir: "/"
  tag: "default"

- name: "check_system_load"
  description: "检查系统负载和进程信息"
  prompt: "检查系统负载情况，显示 CPU 使用率、内存使用情况和 top 进程"
  template: |
    echo "=== 系统负载 ===" &&
    uptime &&
    echo -e "\n=== 内存使用 ===" &&
    free -h &&
    echo -e "\n=== CPU 使用率 ===" &&
    top -bn1 | head -20
  parameters: []
  allowed_hosts: ["prod-*", "staging-*"]
  timeout_sec: 15
  use_shell: true
  working_dir: "/"
  tag: "default"

- name: "analyze_logs"
  description: "分析日志文件中的错误或特定模式"
  prompt: "分析指定日志文件，查找包含特定模式的行，显示最近几小时的记录"
  template: |
    echo "=== 分析日志文件: {log_file} ===" &&
    if [ -f "{log_file}" ]; then
      find {log_file} -mtime -{hours}/24 -exec grep -h "{pattern}" {{}} \\; | tail -n {max_lines}
    else
      echo "日志文件不存在: {log_file}"
    fi
  parameters:
    - name: "log_file"
      type: "string"
      required: true
      description: "日志文件路径"
      validation: "^[a-zA-Z0-9/_-]+\\.(log|txt)$"
    - name: "pattern"
      type: "string"
      required: false
      default: "ERROR"
      description: "搜索模式"
      validation: "^[a-zA-Z0-9_ -]+$"
    - name: "hours"
      type: "integer"
      required: false
      default: 24
      description: "搜索最近几小时的日志"
      validation: "^[0-9]+$"
    - name: "max_lines"
      type: "integer"
      required: false
      default: 50
      description: "最大显示行数"
      validation: "^[0-9]+$"
  allowed_hosts: ["*"]
  timeout_sec: 30
  use_shell: true
  working_dir: "/"
  tag: "default"

- name: "check_network_connections"
  description: "检查网络连接状态和端口监听情况"
  prompt: "检查网络连接状态，显示活跃连接和监听端口"
  template: |
    echo "=== 网络连接统计 ===" &&
    ss -s &&
    echo -e "\n=== TCP 连接 ===" &&
    ss -tulpn | grep LISTEN &&
    echo -e "\n=== 活跃连接 (前20个) ===" &&
    ss -tupn | head -20
  parameters: []
  allowed_hosts: ["*"]
  timeout_sec: 10
  use_shell: true
  working_dir: "/"
  tag: "default"
