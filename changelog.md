# ExecMCP 变更日志

## [v0.0.12] - 2025-10-24

### 新增功能
- **传输协议升级**: 升级 MCP-go 库至 v0.42.0，启用 HTTP 流式传输支持
- **多传输架构**: 重构 MCP 服务器，支持共享 HTTP 服务器承载多种传输方式
- **客户端优化**: 更新 mcptest 客户端使用 `NewStreamableHttpClient` 替代 SSE 传输
- **双端点支持**: 添加 HTTP 流式端点 (`/mcp`) 与传统 SSE 端点 (`/mcp/sse`) 并存

### 技术改进
- 保持向后兼容性，确保现有 SSE 客户端正常工作
- 增强服务器架构的可扩展性
- 更新相关单元测试以验证新的流式传输功能

---

## [v0.0.11] - 2025-10-11

### 新增功能
- **Sudo 提权支持**: 添加 sudo 提权功能，增强命令执行的灵活性和安全性
- **配置增强**: 启用 security.yaml 中的 sudo 支持并扩展命令列表
- **开发工具**: 在 Makefile 中添加 ansible-mcpops 目标
- **配置优化**: 修改 launch.json 参数格式，提升开发体验

### 安全改进
- 完善 .gitignore 配置，添加 .cache 和 ansible 目录
- 增强权限控制的安全机制

---

## [v0.0.10] - 2025-10-10

### 技术改进
- **架构重构**: MCP 服务器和执行服务重构，支持增强的主机元数据和安全配置
- **测试优化**: 修复测试相关问题和边界情况处理

---

## [v0.0.9] - 2025-10-08

### 新增功能
- **客户端兼容性**: 添加对外公开的基础 URL 配置，优化客户端连接兼容性
- **网络配置**: 改进服务器网络配置的灵活性

---

## [v0.0.8] - 2025-10-07

### 修复
- **端口兼容性**: 更新 SSE 服务器的绑定地址，从 8081 修改为 7458，提高客户端兼容性
- **配置修正**: 修正批准命令的最大使用次数描述，默认值应为 0（无限制）

### 用户体验改进
- **错误提示**: 更新命令执行错误信息，提示未在允许列表中的命令需请求批准

---

## [v0.0.7] - 2025-09-30

### 新增功能
- **临时批准机制**: 添加临时命令批准机制，支持命令的临时批准和审计日志记录
- **PTY 支持**: 添加伪终端 (PTY) 支持，增强交互式命令执行能力
- **审计追踪**: 完善审计日志记录功能，支持临时操作的完整追踪

### 技术改进
- 更新相关工具和测试用例
- 增强交互式命令执行的用户体验

---

## [v0.0.6] - 2025-09-25

### 安全增强
- **输入验证**: 增强命令和脚本名称处理，拒绝包含空格的输入
- **安全配置**: 更新命令列表以包含安全配置规则
- **防护机制**: 防止命令注入和路径遍历攻击

---

## [v0.0.5] - 2025-09-20

### 文档改进
- **开发指南**: 添加开发指南和 MCP 工具接口文档
- **安全文档**: 完善配置和安全机制文档

### 代码优化
- **工具描述**: 更新 MCP 工具注册描述，增强参数说明
- **安全测试**: 添加 Docker 日志命令的安全检查测试

### 清理工作
- 删除不再需要的文档文件，包括环境变量配置、设计文档和路线图
- 删除不再需要的 Go 工具链锁定文件
- 更新 .gitignore 文件以包含 .cache 目录

---

## [v0.0.4] - 2025-09-15

### 安全审计
- **审计日志**: 实现安全审计日志功能
- **文档完善**: 添加完整的配置和安全机制文档

---

## [v0.0.3] - 2025-09-10

### CI/CD 改进
- **GitHub Actions**: 更新 GitHub Actions 工作流，添加错误处理和生成变更日志功能
- **代码格式**: 优化代码格式，确保文件末尾有换行符

---

## [v0.0.2] - 2025-09-05

### 安全增强
- **令牌安全**: 更新 GitHub Actions 工作流，使用 PKG_GITHUB_TOKEN 替代 GITHUB_TOKEN 以增强安全性
- **工作流优化**: 添加配置测试、Go Report Card 和全面测试流程

---

## [v0.0.1] - 2025-08-30

### 初始版本
这是一个安全优先的 Go 语言 MCP (Model Context Protocol) 服务器初始版本，提供以下核心功能：

#### 新增功能
- **SSH 连接管理**: 实现安全的 SSH 连接池和会话管理
- **命令执行**: 提供安全的远程命令执行功能，支持流式输出
- **安全过滤**: 实现多层安全过滤引擎，包括精确拒绝、正则拒绝、白名单验证
- **配置系统**: 完整的 YAML 配置解析和验证
- **审计日志**: 结构化日志和审计追踪功能
- **认证机制**: 支持多种 SSH 认证方式（密码、密钥、代理）
- **参数验证**: 实现参数验证与类型检查，增强脚本执行的安全性
- **环境变量管理**: 集中处理环境变量获取和错误包装

#### 安全特性
- **默认拒绝策略**: 除非明确加入白名单，否则阻止所有命令
- **默认无shell**: 直接执行以防止注入攻击
- **多层过滤**: 精确拒绝 → 正则拒绝 → 白名单 → 路径验证
- **资源限制**: 输出大小限制、超时控制、速率限制
- **完整审计**: 所有命令执行都记录上下文信息

#### 开发工具
- **Docker 支持**: 更新 Docker 和 Docker Compose 配置，支持多架构构建
- **自动标签**: 添加自动标签创建脚本
- **测试框架**: 实现 mock SSH 连接管理器用于测试

#### 架构设计
- **MCP 集成**: 与 MCP-Go SSE 传输集成，支持实时双向通信
- **并发处理**: 每请求一个 goroutine 的并发模型
- **错误分类**: 完整的错误分类系统（SECURITY_DENY, TIMEOUT, SSH_ERROR 等）
- **连接池**: 复用 SSH 客户端，管理会话生命周期

---

## 版本时间线

| 版本 | 发布日期 | 主要特性 |
|------|----------|----------|
| v0.0.12 | 2025-10-24 | HTTP 流式传输支持 |
| v0.0.11 | 2025-10-11 | Sudo 提权支持 |
| v0.0.10 | 2025-10-10 | 架构重构 |
| v0.0.9 | 2025-10-08 | 客户端兼容性优化 |
| v0.0.8 | 2025-10-07 | 端口兼容性修复 |
| v0.0.7 | 2025-09-30 | 临时批准机制和 PTY 支持 |
| v0.0.6 | 2025-09-25 | 输入验证增强 |
| v0.0.5 | 2025-09-20 | 文档完善和代码清理 |
| v0.0.4 | 2025-09-15 | 安全审计日志 |
| v0.0.3 | 2025-09-10 | CI/CD 改进 |
| v0.0.2 | 2025-09-05 | 令牌安全增强 |
| v0.0.1 | 2025-08-30 | 初始版本发布 |

---

## 技术栈

- **语言**: Go 1.24.7+
- **主要依赖**:
  - `github.com/mark3labs/mcp-go` - MCP 协议与传输
  - `golang.org/x/crypto/ssh` - SSH 客户端实现
  - `gopkg.in/yaml.v3` - YAML 配置解析
  - `github.com/google/uuid` - UUID 生成

## 许可证

本项目采用开源许可证，具体请查看 LICENSE 文件。

---

*本变更日志记录了 ExecMCP 项目从初始版本到当前版本的完整发展历程，突出了每个版本的主要功能改进、安全增强和修复内容。*
